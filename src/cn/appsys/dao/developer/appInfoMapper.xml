<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "mybatis-3-mapper"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.appsys.dao.developer.appInfoMapper">
	<select id="selectAppInfo" resultType="app_info">
		select a.softwareName,a.APKName,a.softwareSize,a.status,
		(SELECT d.valueName
		FROM data_dictionary d where a.flatformId=d.valueId AND
		typeCode='APP_FLATFORM') AS flatformName,
		(SELECT c.categoryName FROM
		app_category c WHERE c.id=a.categoryLevel1) AS
		categoryLevel1Name,
		(SELECT c.categoryName FROM app_category c WHERE
		c.id=a.categoryLevel2) AS
		categoryLevel2Name,
		(SELECT c.categoryName
		FROM app_category c WHERE c.id=a.categoryLevel3) AS
		categoryLevel3Name,
		(SELECT d.valueName FROM data_dictionary d WHERE
		d.valueId=a.`status` AND
		typeCode='APP_STATUS') AS statusName,
		a.downloads,
		(SELECT v.versionNo FROM app_version v where
		v.id=a.versionId) AS versionNo
		FROM app_info a
		<where>
			<if test="softwareName!=null">and a.softwareName like CONCAT('%',#{softwareName},'%')
			</if>
			<if test="status!=null">and a.`status`=#{status}</if>
			<if test="flatformId!=null"> and a.flatformId=#{flatformId}</if>
			<if test="categoryLevel1!=null">and a.categoryLevel1=#{categoryLevel1}</if>
			<if test="categoryLevel2!=null">and a.categoryLevel2=#{categoryLevel2}</if>
			<if test="categoryLevel3!=null">and a.categoryLevel3=#{categoryLevel3}</if>
		</where>
		LIMIT #{pageIndex},#{pageConut}
	</select>
	<select id="count" resultType="int">
		select COUNT(1) FROM app_info
		<where>
			<if test="softwareName!=null">and softwareName like CONCAT('%',#{softwareName},'%')
			</if>
			<if test="status!=null">and status=#{status} </if>
			<if test="flatformId!=null">and flatformId=#{flatformId}</if>
			<if test="categoryLevel1!=null">and categoryLevel1=#{categoryLevel1}</if>
			<if test="categoryLevel2!=null">and categoryLevel2=#{categoryLevel2}</if>
			<if test="categoryLevel3!=null">and categoryLevel3=#{categoryLevel3}</if>
		</where>
	</select>
	<insert id="appAdd">
	   insert INTO app_info
	   (softwareName,APKName,supportROM,
	   interfaceLanguage,softwareSize,
	   downloads,flatformId,categoryLevel1,
	   categoryLevel2,categoryLevel3,status,appInfo,logoPicPath,logoLocPath,
	   createdBy,creationDate)
	   value(#{softwareName},#{APKName},#{supportROM},#{interfaceLanguage},#{softwareSize},#{downloads},#{flatformId},#{categoryLevel1},#{categoryLevel2},#{categoryLevel3},#{status},#{appInfo},#{logoPicPath},#{logoLocPath},#{createdBy},#{creationDate})
	</insert>
	<select id="findApp" resultType="app_info">
	  select * from app_info where APKName=#{APKName}
	</select>
</mapper>